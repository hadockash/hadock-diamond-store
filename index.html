<!doctype html>
<html lang="si">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Free Fire ID Lookup</title>
  <style>
    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans", "Helvetica Neue", Arial;
      display:flex;
      min-height:100vh;
      align-items:center;
      justify-content:center;
      background: linear-gradient(180deg,#0f172a 0%, #0b1220 100%);
      color:#e6eef8;
      margin:0;
      padding:24px;
    }
    .card{
      width:100%;
      max-width:520px;
      background: rgba(255,255,255,0.04);
      border-radius:12px;
      padding:20px;
      box-shadow: 0 8px 30px rgba(2,6,23,0.6);
      backdrop-filter: blur(6px);
    }
    h1{font-size:20px;margin:0 0 8px}
    p.lead{margin:0 0 18px;color:#bcd3f7}
    label{display:block;margin-bottom:6px;font-weight:600}
    input[type="text"]{
      width:100%;
      padding:10px 12px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,0.06);
      background:rgba(255,255,255,0.02);
      color:inherit;
      box-sizing:border-box;
      margin-bottom:12px;
      outline:none;
    }
    button{
      padding:10px 14px;
      border-radius:8px;
      border:none;
      cursor:pointer;
      font-weight:700;
      background:linear-gradient(90deg,#2dd4bf,#38bdf8);
      color:#042024;
    }
    .result{
      margin-top:14px;
      padding:12px;
      border-radius:8px;
      background: rgba(255,255,255,0.02);
      border:1px solid rgba(255,255,255,0.03);
    }
    .muted{color:#9fb6d9;font-size:13px}
    .error{color:#ffb4b4}
    .hint{font-size:13px;margin-top:8px;color:#9fb6d9}
    .copy{
      margin-left:8px;
      background:transparent;
      color:inherit;
      border:1px solid rgba(255,255,255,0.06);
      padding:6px 8px;border-radius:8px;cursor:pointer;font-weight:600;
    }
  </style>
</head>
<body>
  <main class="card" role="main">
    <h1>Free Fire ID → Name</h1>
    <p class="lead">ඔබගේ අවශ්‍ය Free Fire ID එක ඇතුල් කරන්න — පහත විදියට නාමය පෙන්වෙනවා.</p>

    <form id="lookupForm">
      <label for="ffid">Free Fire ID</label>
      <input id="ffid" name="ffid" type="text" placeholder="උදා: 123456789" required />
      <div style="display:flex;gap:8px;align-items:center">
        <button type="submit">සොයන්න</button>
        <button id="useMock" type="button" class="copy">Mock DB</button>
        <button id="useApi" type="button" class="copy">Use API</button>
      </div>
      <div class="hint">Default: Mock DB. ඔබට සත්‍යාපිත API URL එකක් තියෙනවා නම් පහළ script තුල API_URL වෙනස් කරන්න.</div>
    </form>

    <div id="output" class="result" aria-live="polite" style="display:none"></div>
    <div id="debug" class="muted" style="margin-top:8px">Mode: <span id="modeLabel">MOCK</span></div>
  </main>

  <script>
    (function(){
      // ---------- CONFIG ----------
      // මේ API_URL එකට ඔබට තමන්ගේ Free Fire API (CORS සපයන) තියෙන නම් එක දාන්න.
      // සත්‍ය API උදාහරණයක්:
      // const API_URL = "https://your-server.example.com/freefire/lookup"; // expects GET /?id=123
      let API_URL = ""; // හිස් නම් mock mode යෙදේ

      // Mock database (උදාහරණය)
      const MOCK_DB = {
        "123456": "ආනන්ද",
        "987654": "සුරාජ්",
        "555001": "GamerXYZ",
        "100200": "මෙහෙම_නාමය",
        "999999": "NoobMaster69"
      };

      // ---------- UI ----------
      const form = document.getElementById('lookupForm');
      const ffidInput = document.getElementById('ffid');
      const output = document.getElementById('output');
      const modeLabel = document.getElementById('modeLabel');
      const useMockBtn = document.getElementById('useMock');
      const useApiBtn = document.getElementById('useApi');

      function setMode(mode){
        if(mode === 'API'){
          modeLabel.textContent = 'API';
          API_URL = API_URL || ""; // keep any set value
        } else {
          modeLabel.textContent = 'MOCK';
          API_URL = "";
        }
      }

      useMockBtn.addEventListener('click', ()=> setMode('MOCK'));
      useApiBtn.addEventListener('click', ()=> {
        const custom = prompt("Enter API base URL (example: https://your-server.example.com/freefire/lookup)","");
        if(custom !== null) {
          API_URL = custom.trim();
          setMode(API_URL ? 'API' : 'MOCK');
        }
      });

      // ---------- Lookup logic ----------
      async function lookupById(id){
        id = String(id).trim();
        if(!id) throw new Error("ID එක ලබාදෙන්න.");

        // If API_URL set -> try fetch
        if(API_URL){
          // Two common patterns: GET /?id=123  or GET /123
          // We'll try both: first GET `${API_URL}?id=${id}`, if fails try `${API_URL}/${id}`
          const tryUrls = [
            `${API_URL}${API_URL.includes('?') ? '&' : '?'}id=${encodeURIComponent(id)}`,
            `${API_URL.replace(/\/$/,'')}/${encodeURIComponent(id)}`
          ];

          let lastErr = null;
          for(const url of tryUrls){
            try{
              const resp = await fetch(url, { method: 'GET' });
              if(!resp.ok){
                lastErr = new Error(`API responded ${resp.status} ${resp.statusText}`);
                continue;
              }
              const data = await resp.json();
              // Expectation: API returns { id: "123", name: "PlayerName" } or { name: "..." }
              if(data && (data.name || data.playerName || data.nickname)){
                return { id, name: data.name || data.playerName || data.nickname, raw: data };
              } else {
                // if API returns a mapping object keyed by id
                if(data && data[id]) return { id, name: data[id], raw: data };
                // unknown shape
                return { id, name: null, raw: data };
              }
            }catch(err){
              lastErr = err;
              // try next url
            }
          }
          throw lastErr || new Error("API lookup failed.");
        }

        // MOCK mode
        if(MOCK_DB.hasOwnProperty(id)){
          return { id, name: MOCK_DB[id], raw: { source: "mock" } };
        } else {
          return { id, name: null, raw: { source: "mock" } };
        }
      }

      function showResult(result){
        output.style.display = 'block';
        if(result.name){
          output.innerHTML = `<strong>Found:</strong> <div style="margin-top:6px;font-size:18px">${escapeHtml(result.name)}</div>
                              <div class="muted" style="margin-top:8px">ID: ${escapeHtml(result.id)}</div>
                              <div style="margin-top:10px"><button class="copy" id="copyName">Copy Name</button></div>`;
          document.getElementById('copyName').addEventListener('click', ()=>{
            navigator.clipboard?.writeText(result.name).then(()=> {
              alert('Name copied to clipboard');
            }).catch(()=> alert('Copy failed'));
          });
        } else {
          output.innerHTML = `<div class="error"><strong>නම් හමු නොවීය</strong></div>
                              <div class="muted" style="margin-top:8px">ID: ${escapeHtml(result.id)} — API / Mock යොදා බැලූ විස්තර: <pre style="white-space:pre-wrap">${escapeHtml(JSON.stringify(result.raw))}</pre></div>`;
        }
      }

      function showError(err){
        output.style.display = 'block';
        output.innerHTML = `<div class="error"><strong>දෝෂයක් —</strong> ${escapeHtml(String(err && err.message ? err.message : err))}</div>`;
      }

      // simple esc
      function escapeHtml(s){
        return String(s).replace(/[&<>"'`]/g, (m)=> ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;','`':'&#96;'}[m]));
      }

      form.addEventListener('submit', async (e)=>{
        e.preventDefault();
        output.style.display='none';
        const val = ffidInput.value.trim();
        if(!val){
          showError("ID එක ඇතුල් කරන්න.");
          return;
        }
        output.style.display='block';
        output.innerHTML = "<div class='muted'>සෙවීම සිදුවෙමින්... (මෙය ඔබගේ browser එක තුල)</div>";
        try{
          const res = await lookupById(val);
          showResult(res);
        }catch(err){
          showError(err);
        }
      });

      // initial mode label
      setMode(API_URL ? 'API' : 'MOCK');

    })();
  </script>
</body>
  </html>
